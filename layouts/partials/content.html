<!-- Regex logic that sanitizes wikilinks spaces -->

{{ $firstBracket := "\\[\\[" }}
{{ $lastBracket := "\\]\\]" }}

<!-- 
	
@todo:wikilinks not working for notes with question/exclamation marks
see lista-de-preguntas-interesantes-a-responder.html
-->
{{ $wikiregex := "\\[\\[([^/]+?)\\]\\]" }}

<!-- @todo: 

fix regex for cases: 
1-único-ejercicio-por-área-de-interés.html
antes-de-pensar-en-crear-cursos-he-de-cultivar-mis-notas-evergreen.html
Categorizamos la información para facilitar el aprendizaje
Más vale pájaro en mano que ciento volando
 -->

<!-- Tags containing spaces ended with a newline -->
{{ $tagregex3 := "#([^\\s^#][^#]*[^\\s^#])#\\n" }}

<!-- Tags containing spaces ended with a space -->
{{ $tagregex2 := "#([^\\s^#][^#]*[^\\s^#])#\\s" }}

<!-- Regular tags -->
{{ $tagregex := "#([^#\\s\\,]+)" }}
{{ $tagregexB := "#([^#\\s\\,]+)#" }}

{{ $subgroup1 := .Content | findRE $wikiregex }}

{{ $.Scratch.Add "content" .RawContent }}

{{ range $subgroup1 }}
	{{ $rawItem := . }}
	{{ $capturedGroup := $rawItem | replaceRE $wikiregex "$1" }}
	{{ $itemPattern :=  printf "%s%s%s" $firstBracket $capturedGroup $lastBracket }}
	{{ $anchorized := $capturedGroup | anchorize }}
	
	{{ $link := printf "%s%s%s%s%s%s" "<a href=\"" $anchorized ".html" "\">" $capturedGroup "</a>" }}
	
	{{ $tmpContent := $.Scratch.Get "content" | replaceRE $itemPattern $link }}
	{{ $.Scratch.Set "content" $tmpContent }}
{{ end }}

{{ $content := .Scratch.Get "content" }}

{{ $content := $content | replaceRE $tagregex3 "<a class=\"hashtag\" onclick=\"focusTag(this)\">$1</a><br>"  | safeHTML }}

{{ $content := $content | replaceRE $tagregex2 "<a class=\"hashtag\" onclick=\"focusTag(this)\">$1</a>"  | safeHTML }}

{{ $content := $content | replaceRE $tagregexB "<a class=\"hashtag\" onclick=\"focusTag(this)\">$1</a>"  | safeHTML }}

{{ $content := $content | replaceRE $tagregex "<a class=\"hashtag\" onclick=\"focusTag(this)\">$1</a>"  | safeHTML }}

{{ $content := $content | replaceRE "->" "→" }}

{{ $content := $content | replaceRE "::([^/]+?)::" "<mark>$1</mark>" }}

{{ $content := $content | replaceRE "==([^/]+?)==" "<mark>$1</mark>" }}

{{ $content | markdownify }}

