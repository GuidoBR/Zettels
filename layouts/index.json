{{ $tagregex3 := "#([^\\s^#][^#]*[^\\s^#])#\\n" }}
{{ $tagregex2 := "#([^\\s^#][^#]*[^\\s^#])#\\s" }}
{{ $tagregex := "#([^#\\s\\,]+)" }}

{{- $.Scratch.Add "index" slice -}}
{{- range where .Site.RegularPages "Type" "not in" (slice "page" "json") -}}
    
    {{- $.Scratch.Add "tags" slice -}}
    
    {{ $.Scratch.Set "title" "" }}
    {{ if eq (.Param "bear") true }}
        {{ $.Scratch.Set "title" .File.BaseFileName }}
    {{ else }}
        {{ $.Scratch.Set "title" .Title }}
    {{ end }}
    {{ $title := $.Scratch.Get "title" }}
    
    {{ $.Scratch.Set "summary" "" }}
    {{- if and (isset .Params "private") (eq .Params.private true) -}}
        {{ $.Scratch.Set "summary" "üîê Private note" }}
    {{- else -}}
        {{ $.Scratch.Set "summary" (.Summary | truncate 70) }}
    {{- end -}}
    {{ $summary := $.Scratch.Get "summary" }}
    
    {{ $tags3 := .RawContent | findRE $tagregex3 }}
    {{ $tags2 := .RawContent | findRE $tagregex2 }}
    {{ $tags := .RawContent | findRE $tagregex }}

    {{ $allTags := (slice $tags3 $tags2 $tags) }}
    
    {{- $.Scratch.Add "index" (dict "title" $title "permalink" .Permalink "summary" $summary "tags" $allTags ) -}}
    
{{- end -}}
{{- $.Scratch.Get "index" | jsonify -}}